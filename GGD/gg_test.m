clc;clear;close all;
%t = -5:0.1:5;
t = [-15,-13,-10,-9,-7,-5,-3,0,2,4.5,6.5,8,10,12.5,15];
%xdata = [-8.86910650221307,-8.56910650221307,-8.26910650221307,-7.96910650221307,-7.66910650221307,-7.36910650221307,-7.06910650221307,-6.76910650221307,-6.46910650221307,-6.16910650221307,-5.86910650221307,-5.56910650221307,-5.26910650221307,-4.96910650221307,-4.66910650221307,-4.36910650221307,-4.06910650221307,-3.76910650221307,-3.46910650221307,-3.16910650221307,-2.86910650221307,-2.56910650221307,-2.26910650221307,-1.96910650221307,-1.66910650221307,-1.36910650221307,-1.06910650221307,-0.769106502213071,-0.469106502213071,-0.169106502213070,0.130893497786929,0.430893497786929,0.730893497786929,1.03089349778693,1.33089349778693,1.63089349778693,1.93089349778693,2.23089349778693,2.53089349778693,2.83089349778693,3.13089349778693,3.43089349778693,3.73089349778693,4.03089349778693,4.33089349778693,4.63089349778693,4.93089349778693,5.23089349778693,5.53089349778693,5.83089349778693,6.13089349778693,6.43089349778693,6.73089349778693,7.03089349778693];
%load('yi.mat');
%y = y;
y = [-16,-14,-12,-10,-8,-6,-3.7,-1.8,-3.7,-6,-8,-10,-12,-14,-16];
y = y+17;

fun = @(x)(x(1)./(2.*sqrt(x(2).*(gamma(1./x(1))./gamma(3./x(1)))).*gamma(1./x(1)))).*exp(-(abs(t)./(sqrt(x(2).*(gamma(1./x(1))./gamma(3./x(1)))))).^x(1)) - y;
lb = [0.3,-20];
ub = [1,50];
x0 = [0.5,0.1];
x = lsqnonlin(fun,x0,lb,ub)
plot(t,y,'or',t,fun(x)+y,'b-')
xlabel('t')
legend('Normal density','Fitted function')

%ydata = [-8.95776800997116,-8.95776800997116,-8.95776800997116,-8.55230290186300,-8.26462082941122,-7.85915572130305,-8.95776800997116,-8.95776800997116,-7.34833009753706,-7.34833009753706,-8.26462082941122,-6.55987273717279,-6.47286136018316,-6.06739625207500,-5.96203573641717,-5.86672555661285,-5.12912661348207,-4.84689414579785,-4.81463328357963,-4.45795833964090,-4.12945427266886,-3.50672955640546,-3.40093994827162,-3.12295727290856,-2.66619887041284,-2.24238462363648,-1.66815748851999,-1.35736567547076,-0.731729580485677,-0.101534453828000,0,-0.566364824613223,-1.11039617381137,-1.85444594744505,-2.16318142909466,-2.63161853681606,-3.02023180488873,-3.30177619915131,-3.66950097927663,-3.94713271587491,-4.26642012774202,-4.68110189095511,-4.88023056606544,-5.59047217998469,-5.91324557224774,-5.82227379404201,-6.47286136018316,-6.39281865250962,-7.01185786091585,-6.65518291697712,-7.34833009753706,-7.57147364885127,-7.70500504147579,-7.85915572130305];
% fun1 = @(x,xdata) x(1)+x(2)*exp(-(xdata./x(3)).^2);  %自定义函数类型
% 
% xdata = [-15,-13,-10,-9,-7,-5,-3,0,2,4.5,6.5,8,10,12.5,15];
% ydata = [-16,-14,-12,-10,-8,-6,-3.7,-1.8,-3.7,-6,-8,-10,-12,-14,-16];
%ydata = ydata+17;
%b=[0.1,2];
%fun=inline('b(1)*(1-b(2)*exp(-b(3)*x))','b','x');
%fun=inline('(b(1)./(2.*sqrt(b(2).*(gamma(1./b(1))./gamma(3./b(1)))).*gamma(1./b(1)))).*exp(-(abs(x)./(sqrt(b(2).*(gamma(1./b(1))./gamma(3./b(1)))))).^b(1))','b','x');
%[b,r,j]=nlinfit(x,y,fun,b);
%fun1 = @(x,xdata) (x(1)./(2.*sqrt(x(2).*(gamma(1./x(1))./gamma(3./x(1)))).*gamma(1./x(1)))).*exp(-(abs(xdata)./(sqrt(x(2).*(gamma(1./x(1))./gamma(3./x(1)))))).^x(1));
%@(a,b,x) (a./(2.*sqrt(b.*(gamma(1./a)./gamma(3./a))).*gamma(1./a))).*exp(-(abs(x)./(sqrt(b.*(gamma(1./a)./gamma(3./a))))).^a)
%X0=[0,1120,740];      %初始参数
%X0=[0.1,2];
[X,resnorm]=lsqcurvefit(fun1,X0,xdata,ydata); %resnorm残差平方和  X是参数
disp(X) %得到所求参数
 
%画图
xi=-10:0.01:10;
yi=fun1(X,xi); %调用函数句柄
plot(xi,yi)
hold on
plot(xdata,ydata,'or')